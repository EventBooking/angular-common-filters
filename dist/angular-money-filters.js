/// <reference path="../typings/tsd.d.ts"/>
var MoneyFiltersModule;
(function (MoneyFiltersModule) {
    var Module = (function () {
        function Module(name, modules, config) {
            this.module = angular.module(name, modules, config);
        }
        Module.prototype.config = function (appConfig) {
            this.module.config(appConfig);
            return this;
        };
        Module.prototype.run = function (appRun) {
            this.module.run(appRun);
            return this;
        };
        Module.prototype.controller = function (name, controller) {
            this.module.controller(name, controller);
            return this;
        };
        Module.prototype.directive = function (name, directive) {
            this.module.directive(name, DirectiveFactory.create(directive));
            return this;
        };
        Module.prototype.filter = function (name, filter) {
            this.module.filter(name, FilterFactory.create(filter));
            return this;
        };
        Module.prototype.service = function (name, service) {
            this.module.service(name, service);
            return this;
        };
        Module.prototype.provider = function (name, provider) {
            this.module.provider(name, provider);
            return this;
        };
        Module.prototype.factory = function (name, factory) {
            this.module.factory(name, factory);
            return this;
        };
        Module.prototype.constant = function (name, value) {
            this.module.constant(name, value);
            return this;
        };
        return Module;
    })();
    MoneyFiltersModule.Module = Module;
    // filters
    var FilterFactory = (function () {
        function FilterFactory() {
        }
        FilterFactory.create = function (type) {
            var filter = function () {
                var inject = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    inject[_i - 0] = arguments[_i];
                }
                var instance = Activator.create(type, inject);
                return function () {
                    var options = [];
                    for (var _i = 0; _i < arguments.length; _i++) {
                        options[_i - 0] = arguments[_i];
                    }
                    return instance.filter.apply(instance, options);
                };
            };
            filter["$inject"] = type["$inject"];
            return filter;
        };
        return FilterFactory;
    })();
    // directives
    var DirectiveFactory = (function () {
        function DirectiveFactory() {
        }
        DirectiveFactory.create = function (type) {
            var directive = function () {
                var inject = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    inject[_i - 0] = arguments[_i];
                }
                return Activator.create(type, inject);
            };
            directive["$inject"] = type["$inject"];
            return directive;
        };
        return DirectiveFactory;
    })();
    var Activator = (function () {
        function Activator() {
        }
        Activator.create = function (type, params) {
            var instance = Object.create(type.prototype);
            instance.constructor.apply(instance, params);
            return instance;
        };
        return Activator;
    })();
})(MoneyFiltersModule || (MoneyFiltersModule = {}));
/// <reference path="../typings/tsd.d.ts"/>
/// <reference path="../twix.d.ts"/>
/// <reference path="angular.ts"/>
var app = new MoneyFiltersModule.Module("moneyFilters", []);
/// <reference path="filters.ts"/>
var MoneyFiltersModule;
(function (MoneyFiltersModule) {
    var MoneyFilter = (function () {
        function MoneyFilter() {
        }
        MoneyFilter.prototype.filter = function (value, code, options) {
            if (value == null || angular.isString(value) && value.trim().length === 0)
                return "";
            if (angular.isObject(code)) {
                options = code;
                code = null;
            }
            if (value.amount) {
                code = value.currency || code;
                value = value.amount;
            }
            if (!options)
                options = {};
            if (options.abbrev) {
                var v = accounting.unformat(value);
                if (v >= 1000) {
                    value = v / 1000;
                    options.precision = 1;
                    options.format = "%s%vK";
                }
                if (v >= 1000000) {
                    value = v / 1000000;
                    options.precision = 1;
                    options.format = "%s%vM";
                }
            }
            options.symbol = currency.symbolize(code);
            return accounting.formatMoney(value, options);
        };
        return MoneyFilter;
    })();
    app.filter('money', MoneyFilter);
})(MoneyFiltersModule || (MoneyFiltersModule = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1tb25leS1maWx0ZXJzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL21vbmV5LWZpbHRlcnMvYW5ndWxhci50cyIsIi4uL3NyYy9tb25leS1maWx0ZXJzL2ZpbHRlcnMudHMiLCIuLi9zcmMvbW9uZXktZmlsdGVycy9tb25leS50cyJdLCJuYW1lcyI6WyJNb25leUZpbHRlcnNNb2R1bGUiLCJNb25leUZpbHRlcnNNb2R1bGUuTW9kdWxlIiwiTW9uZXlGaWx0ZXJzTW9kdWxlLk1vZHVsZS5jb25zdHJ1Y3RvciIsIk1vbmV5RmlsdGVyc01vZHVsZS5Nb2R1bGUuY29uZmlnIiwiTW9uZXlGaWx0ZXJzTW9kdWxlLk1vZHVsZS5ydW4iLCJNb25leUZpbHRlcnNNb2R1bGUuTW9kdWxlLmNvbnRyb2xsZXIiLCJNb25leUZpbHRlcnNNb2R1bGUuTW9kdWxlLmRpcmVjdGl2ZSIsIk1vbmV5RmlsdGVyc01vZHVsZS5Nb2R1bGUuZmlsdGVyIiwiTW9uZXlGaWx0ZXJzTW9kdWxlLk1vZHVsZS5zZXJ2aWNlIiwiTW9uZXlGaWx0ZXJzTW9kdWxlLk1vZHVsZS5wcm92aWRlciIsIk1vbmV5RmlsdGVyc01vZHVsZS5Nb2R1bGUuZmFjdG9yeSIsIk1vbmV5RmlsdGVyc01vZHVsZS5Nb2R1bGUuY29uc3RhbnQiLCJNb25leUZpbHRlcnNNb2R1bGUuRmlsdGVyRmFjdG9yeSIsIk1vbmV5RmlsdGVyc01vZHVsZS5GaWx0ZXJGYWN0b3J5LmNvbnN0cnVjdG9yIiwiTW9uZXlGaWx0ZXJzTW9kdWxlLkZpbHRlckZhY3RvcnkuY3JlYXRlIiwiTW9uZXlGaWx0ZXJzTW9kdWxlLkRpcmVjdGl2ZUZhY3RvcnkiLCJNb25leUZpbHRlcnNNb2R1bGUuRGlyZWN0aXZlRmFjdG9yeS5jb25zdHJ1Y3RvciIsIk1vbmV5RmlsdGVyc01vZHVsZS5EaXJlY3RpdmVGYWN0b3J5LmNyZWF0ZSIsIk1vbmV5RmlsdGVyc01vZHVsZS5BY3RpdmF0b3IiLCJNb25leUZpbHRlcnNNb2R1bGUuQWN0aXZhdG9yLmNvbnN0cnVjdG9yIiwiTW9uZXlGaWx0ZXJzTW9kdWxlLkFjdGl2YXRvci5jcmVhdGUiLCJNb25leUZpbHRlcnNNb2R1bGUuTW9uZXlGaWx0ZXIiLCJNb25leUZpbHRlcnNNb2R1bGUuTW9uZXlGaWx0ZXIuY29uc3RydWN0b3IiLCJNb25leUZpbHRlcnNNb2R1bGUuTW9uZXlGaWx0ZXIuZmlsdGVyIl0sIm1hcHBpbmdzIjoiQUFBQSwyQ0FBMkM7QUFFM0MsSUFBTyxrQkFBa0IsQ0F3R3hCO0FBeEdELFdBQU8sa0JBQWtCLEVBQUMsQ0FBQztJQWN2QkE7UUFHSUMsZ0JBQVlBLElBQVlBLEVBQUVBLE9BQWtCQSxFQUFFQSxNQUFpQkE7WUFDM0RDLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLE9BQU9BLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLEVBQUVBLE9BQU9BLEVBQUVBLE1BQU1BLENBQUNBLENBQUNBO1FBQ3hEQSxDQUFDQTtRQUVERCx1QkFBTUEsR0FBTkEsVUFBT0EsU0FBbUJBO1lBQ3RCRSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQTtZQUM5QkEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7UUFDaEJBLENBQUNBO1FBRURGLG9CQUFHQSxHQUFIQSxVQUFJQSxNQUFnQkE7WUFDaEJHLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1lBQ3hCQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQTtRQUNoQkEsQ0FBQ0E7UUFFREgsMkJBQVVBLEdBQVZBLFVBQVdBLElBQVlBLEVBQUVBLFVBQW9CQTtZQUN6Q0ksSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsSUFBSUEsRUFBRUEsVUFBVUEsQ0FBQ0EsQ0FBQ0E7WUFDekNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO1FBQ2hCQSxDQUFDQTtRQUVESiwwQkFBU0EsR0FBVEEsVUFBVUEsSUFBWUEsRUFBRUEsU0FB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REEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2ZBLEtBQUtBLEdBQUdBLENBQUNBLEdBQUdBLE9BQU9BLENBQUNBO29CQUNwQkEsT0FBT0EsQ0FBQ0EsU0FBU0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7b0JBQ3RCQSxPQUFPQSxDQUFDQSxNQUFNQSxHQUFHQSxPQUFPQSxDQUFDQTtnQkFDN0JBLENBQUNBO1lBQ0xBLENBQUNBO1lBRURBLE9BQU9BLENBQUNBLE1BQU1BLEdBQUdBLFFBQVFBLENBQUNBLFNBQVNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBRTFDQSxNQUFNQSxDQUFDQSxVQUFVQSxDQUFDQSxXQUFXQSxDQUFDQSxLQUFLQSxFQUFFQSxPQUFPQSxDQUFDQSxDQUFDQTtRQUNsREEsQ0FBQ0E7UUFDTEYsa0JBQUNBO0lBQURBLENBQUNBLEFBckNEckIsSUFxQ0NBO0lBRURBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLE9BQU9BLEVBQUVBLFdBQVdBLENBQUNBLENBQUNBO0FBQ3JDQSxDQUFDQSxFQTdDTSxrQkFBa0IsS0FBbEIsa0JBQWtCLFFBNkN4QiIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBpbmdzL3RzZC5kLnRzXCIvPlxyXG5cclxubW9kdWxlIE1vbmV5RmlsdGVyc01vZHVsZSB7XHJcblxyXG4gICAgZXhwb3J0IGludGVyZmFjZSBJTW9kdWxlIHtcclxuICAgICAgICBjb25maWcoYXBwQ29uZmlnOiBGdW5jdGlvbik6IElNb2R1bGU7XHJcbiAgICAgICAgcnVuKGFwcFJ1bjogRnVuY3Rpb24pOiBJTW9kdWxlO1xyXG4gICAgICAgIGNvbnRyb2xsZXIobmFtZTogc3RyaW5nLCBjb250cm9sbGVyOiBGdW5jdGlvbik6IElNb2R1bGU7XHJcbiAgICAgICAgZGlyZWN0aXZlKG5hbWU6IHN0cmluZywgZGlyZWN0aXZlOiBhbnkpOiBJTW9kdWxlO1xyXG4gICAgICAgIGZpbHRlcihuYW1lOiBzdHJpbmcsIGZpbHRlcjogYW55KTogSU1vZHVsZTtcclxuICAgICAgICBzZXJ2aWNlKG5hbWU6IHN0cmluZywgc2VydmljZTogRnVuY3Rpb24pOiBJTW9kdWxlO1xyXG4gICAgICAgIHByb3ZpZGVyKG5hbWU6IHN0cmluZywgcHJvdmlkZXI6IGFueSk6IElNb2R1bGU7XHJcbiAgICAgICAgZmFjdG9yeShuYW1lOiBzdHJpbmcsIGZhY3Rvcnk6IEZ1bmN0aW9uKTogSU1vZHVsZTtcclxuICAgICAgICBjb25zdGFudChuYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnkpOiBJTW9kdWxlO1xyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBjbGFzcyBNb2R1bGUgaW1wbGVtZW50cyBJTW9kdWxlIHtcclxuICAgICAgICBwcml2YXRlIG1vZHVsZTogbmcuSU1vZHVsZTtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdHJ1Y3RvcihuYW1lOiBzdHJpbmcsIG1vZHVsZXM/OiBzdHJpbmdbXSwgY29uZmlnPzogRnVuY3Rpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5tb2R1bGUgPSBhbmd1bGFyLm1vZHVsZShuYW1lLCBtb2R1bGVzLCBjb25maWcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uZmlnKGFwcENvbmZpZzogRnVuY3Rpb24pOiBJTW9kdWxlIHtcclxuICAgICAgICAgICAgdGhpcy5tb2R1bGUuY29uZmlnKGFwcENvbmZpZyk7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcnVuKGFwcFJ1bjogRnVuY3Rpb24pOiBJTW9kdWxlIHtcclxuICAgICAgICAgICAgdGhpcy5tb2R1bGUucnVuKGFwcFJ1bik7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29udHJvbGxlcihuYW1lOiBzdHJpbmcsIGNvbnRyb2xsZXI6IEZ1bmN0aW9uKTogSU1vZHVsZSB7XHJcbiAgICAgICAgICAgIHRoaXMubW9kdWxlLmNvbnRyb2xsZXIobmFtZSwgY29udHJvbGxlcik7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZGlyZWN0aXZlKG5hbWU6IHN0cmluZywgZGlyZWN0aXZlKTogSU1vZHVsZSB7XHJcbiAgICAgICAgICAgIHRoaXMubW9kdWxlLmRpcmVjdGl2ZShuYW1lLCBEaXJlY3RpdmVGYWN0b3J5LmNyZWF0ZShkaXJlY3RpdmUpKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmaWx0ZXIobmFtZTogc3RyaW5nLCBmaWx0ZXIpOiBJTW9kdWxlIHtcclxuICAgICAgICAgICAgdGhpcy5tb2R1bGUuZmlsdGVyKG5hbWUsIEZpbHRlckZhY3RvcnkuY3JlYXRlKGZpbHRlcikpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNlcnZpY2UobmFtZTogc3RyaW5nLCBzZXJ2aWNlOiBGdW5jdGlvbik6IElNb2R1bGUge1xyXG4gICAgICAgICAgICB0aGlzLm1vZHVsZS5zZXJ2aWNlKG5hbWUsIHNlcnZpY2UpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByb3ZpZGVyKG5hbWU6IHN0cmluZywgcHJvdmlkZXIpOiBJTW9kdWxlIHtcclxuICAgICAgICAgICAgdGhpcy5tb2R1bGUucHJvdmlkZXIobmFtZSwgcHJvdmlkZXIpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZhY3RvcnkobmFtZTogc3RyaW5nLCBmYWN0b3J5OiBGdW5jdGlvbik6IElNb2R1bGUge1xyXG4gICAgICAgICAgICB0aGlzLm1vZHVsZS5mYWN0b3J5KG5hbWUsIGZhY3RvcnkpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0YW50KG5hbWU6IHN0cmluZywgdmFsdWUpOiBJTW9kdWxlIHtcclxuICAgICAgICAgICAgdGhpcy5tb2R1bGUuY29uc3RhbnQobmFtZSwgdmFsdWUpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZmlsdGVyc1xyXG4gICAgY2xhc3MgRmlsdGVyRmFjdG9yeSB7XHJcbiAgICAgICAgc3RhdGljIGNyZWF0ZSh0eXBlOiBJQWN0aXZhdG9yQ2xhc3MpOiBhbnkge1xyXG4gICAgICAgICAgICB2YXIgZmlsdGVyID0gKC4uLmluamVjdDogYW55W10pID0+IHtcclxuICAgICAgICAgICAgICAgIHZhciBpbnN0YW5jZSA9IEFjdGl2YXRvci5jcmVhdGUodHlwZSwgaW5qZWN0KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoLi4ub3B0aW9uczogYW55W10pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5zdGFuY2UuZmlsdGVyLmFwcGx5KGluc3RhbmNlLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGZpbHRlcltcIiRpbmplY3RcIl0gPSB0eXBlW1wiJGluamVjdFwiXTtcclxuICAgICAgICAgICAgcmV0dXJuIGZpbHRlcjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZGlyZWN0aXZlc1xyXG4gICAgY2xhc3MgRGlyZWN0aXZlRmFjdG9yeSB7XHJcbiAgICAgICAgc3RhdGljIGNyZWF0ZSh0eXBlOiBJQWN0aXZhdG9yQ2xhc3MpOiBhbnkge1xyXG4gICAgICAgICAgICB2YXIgZGlyZWN0aXZlID0gKC4uLmluamVjdDogYW55W10pID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBBY3RpdmF0b3IuY3JlYXRlKHR5cGUsIGluamVjdCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGRpcmVjdGl2ZVtcIiRpbmplY3RcIl0gPSB0eXBlW1wiJGluamVjdFwiXTtcclxuICAgICAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gYWN0aXZhdG9yXHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIElBY3RpdmF0b3JDbGFzcyB7XHJcbiAgICAgICAgbmV3KC4uLnBhcmFtczogYW55W10pO1xyXG4gICAgfVxyXG5cclxuICAgIGNsYXNzIEFjdGl2YXRvciB7XHJcbiAgICAgICAgc3RhdGljIGNyZWF0ZSh0eXBlOiBJQWN0aXZhdG9yQ2xhc3MsIHBhcmFtczogYW55W10pIHtcclxuICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gT2JqZWN0LmNyZWF0ZSh0eXBlLnByb3RvdHlwZSk7XHJcbiAgICAgICAgICAgIGluc3RhbmNlLmNvbnN0cnVjdG9yLmFwcGx5KGluc3RhbmNlLCBwYXJhbXMpO1xyXG4gICAgICAgICAgICByZXR1cm4gaW5zdGFuY2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59IiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGluZ3MvdHNkLmQudHNcIi8+XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90d2l4LmQudHNcIi8+XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJhbmd1bGFyLnRzXCIvPlxyXG52YXIgYXBwID0gbmV3IE1vbmV5RmlsdGVyc01vZHVsZS5Nb2R1bGUoXCJtb25leUZpbHRlcnNcIiwgW10pOyIsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJmaWx0ZXJzLnRzXCIvPlxyXG5cclxuZGVjbGFyZSB2YXIgY3VycmVuY3k7XHJcblxyXG5tb2R1bGUgTW9uZXlGaWx0ZXJzTW9kdWxlIHtcclxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSU1vbmV5RmlsdGVyIHtcclxuICAgICAgICBmaWx0ZXIodmFsdWU6IGFueSwgY29kZT86IHN0cmluZywgb3B0aW9ucz86IGFueSk6IHN0cmluZ1xyXG4gICAgfVxyXG5cclxuICAgIGNsYXNzIE1vbmV5RmlsdGVyIGltcGxlbWVudHMgSU1vbmV5RmlsdGVyIHtcclxuICAgICAgICBmaWx0ZXIodmFsdWU6IGFueSwgY29kZT86IHN0cmluZywgb3B0aW9ucz86IGFueSk6IHN0cmluZyB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsIHx8IGFuZ3VsYXIuaXNTdHJpbmcodmFsdWUpICYmIHZhbHVlLnRyaW0oKS5sZW5ndGggPT09IDApXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZihhbmd1bGFyLmlzT2JqZWN0KGNvZGUpKSB7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gY29kZTtcclxuICAgICAgICAgICAgICAgIGNvZGUgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodmFsdWUuYW1vdW50KSB7XHJcbiAgICAgICAgICAgICAgICBjb2RlID0gdmFsdWUuY3VycmVuY3kgfHwgY29kZTtcclxuICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuYW1vdW50O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIW9wdGlvbnMpXHJcbiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307XHJcblxyXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5hYmJyZXYpIHtcclxuICAgICAgICAgICAgICAgIHZhciB2ID0gYWNjb3VudGluZy51bmZvcm1hdCh2YWx1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHYgPj0gMTAwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdiAvIDEwMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wcmVjaXNpb24gPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZm9ybWF0ID0gXCIlcyV2S1wiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHYgPj0gMTAwMDAwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdiAvIDEwMDAwMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wcmVjaXNpb24gPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZm9ybWF0ID0gXCIlcyV2TVwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBvcHRpb25zLnN5bWJvbCA9IGN1cnJlbmN5LnN5bWJvbGl6ZShjb2RlKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBhY2NvdW50aW5nLmZvcm1hdE1vbmV5KHZhbHVlLCBvcHRpb25zKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYXBwLmZpbHRlcignbW9uZXknLCBNb25leUZpbHRlcik7XHJcbn0iXX0=